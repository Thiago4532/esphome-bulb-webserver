var G=t=>{throw TypeError(t)};var W=(t,e,r)=>e.has(t)||G("Cannot "+r);var o=(t,e,r)=>(W(t,e,"read from private field"),r?r.call(t):e.get(t)),f=(t,e,r)=>e.has(t)?G("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),a=(t,e,r,n)=>(W(t,e,"write to private field"),n?n.call(t,r):e.set(t,r),r),H=(t,e,r)=>(W(t,e,"access private method"),r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function r(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(s){if(s.ep)return;s.ep=!0;const l=r(s);fetch(s.href,l)}})();const z=`
  <div id="app">
    <div class="container">
      <input type="range" id="brightness-slider" min="0.0" max="1.0" value="0.5" step="0.004" disabled>
      <div class="value">Brightness: <span id="brightness-label"></span></div>
    </div>
    <div class="container">
      <input type="range" id="temperature-slider" min="0.0" max="1.0" value="0.5" step="0.004" disabled>
      <div class="value">Temperature: <span id="temperature-label"></span></div>
      <button id="power-button" disabled>Turn On</button>
    </div>
    <div class="container">
      <canvas id="color-wheel" width="300" height="300"></canvas>
      <div id="color-display">RGB: (1.00, 0.00, 0.00)</div>
    </div>
  </div>
`;document.body.innerHTML=z;const Q=500;function L(t){if(!Number.isInteger(t))return null;const e=new ArrayBuffer(4);return new DataView(e).setUint32(0,t,!0),new DataView(e).getFloat32(0,!0)}function v(t,e,r){return Math.min(Math.max(t,e),r)}function $(t,e){if(!t)throw new Error(e)}var B,M,d,I,h,y,w,D,R,K;const j=class j{constructor(e){f(this,R);f(this,B);f(this,M);f(this,d);f(this,I);f(this,h);f(this,y);f(this,w);f(this,D);var r,n,s;a(this,B,e.state??!1),a(this,d,{r:L((r=e.color)==null?void 0:r.r)??1,g:L((n=e.color)==null?void 0:n.g)??1,b:L((s=e.color)==null?void 0:s.b)??1}),a(this,I,L(e.brightness)??1),a(this,h,e.color_mode??"color_temp"),a(this,y,L(e.min_color_temp)??0),a(this,w,L(e.max_color_temp)??0),a(this,M,L(e.color_temp)??(o(this,y)+o(this,w))/2),$(o(this,y)<=o(this,w),"Min color temperature must be less than or equal to max color temperature"),a(this,D,null)}get state(){return o(this,B)}set state(e){a(this,B,!!e)}get color_temp(){return o(this,M)}set color_temp(e){a(this,M,v(e,o(this,y),o(this,w))),a(this,h,"color_temp")}get red(){return o(this,d).r}set red(e){o(this,d).r=v(e,0,1),a(this,h,"rgb")}get green(){return o(this,d).g}set green(e){o(this,d).g=v(e,0,1),a(this,h,"rgb")}get blue(){return o(this,d).b}set blue(e){o(this,d).b=v(e,0,1),a(this,h,"rgb")}setColor(e,r,n){o(this,d).r=v(e,0,1),o(this,d).g=v(r,0,1),o(this,d).b=v(n,0,1),a(this,h,"rgb")}get brightness(){return o(this,I)}set brightness(e){a(this,I,v(e,0,1))}get color_mode(){return o(this,h)}set color_mode(e){e==="color_temp"||e==="rgb"?a(this,h,e):console.log("Unknown color mode:",e)}get min_color_temp(){return o(this,y)}get max_color_temp(){return o(this,w)}static async fetch(){const r=await(await fetch("/light/rgbcct_bulb/dump")).json();return new j(r)}async debounce(){clearTimeout(o(this,D)),a(this,D,setTimeout(()=>{H(this,R,K).call(this)},Q))}};B=new WeakMap,M=new WeakMap,d=new WeakMap,I=new WeakMap,h=new WeakMap,y=new WeakMap,w=new WeakMap,D=new WeakMap,R=new WeakSet,K=async function(){if(!o(this,B)){try{await fetch("/light/rgbcct_bulb/turn_off",{method:"POST"}),console.log("Light state:",this)}catch(n){console.error("Failed to update light state:",n)}return}const e={};e.brightness=o(this,I)*255,o(this,h)==="color_temp"?e.color_temp=o(this,M):o(this,h)==="rgb"&&(e.r=o(this,d).r*255,e.g=o(this,d).g*255,e.b=o(this,d).b*255);const r=new URLSearchParams(e).toString();console.log("Query string:",r);try{await fetch("/light/rgbcct_bulb/turn_on?"+r,{method:"POST"}),console.log("Light state:",this)}catch(n){console.error("Failed to update light state:",n)}};let A=j,i;const P={slider:document.getElementById("brightness-slider"),label:document.getElementById("brightness-label")},T={slider:document.getElementById("temperature-slider"),label:document.getElementById("temperature-label")},N=document.getElementById("power-button");P.slider.disabled=!0;T.slider.disabled=!0;N.disabled=!0;const x=document.getElementById("color-wheel"),C=x.getContext("2d"),J=document.getElementById("color-display"),_=300,b=_/2;x.width=x.height=_;x.style.width=x.style.height=_+"px";let S=null,V=null;function X(t,e,r){let n=(t*180/Math.PI%360+360)%360,s=e,l=r,c=l*s,m=c*(1-Math.abs(n/60%2-1)),E=l-c,g,p,u;n<60?(g=c,p=m,u=0):n<120?(g=m,p=c,u=0):n<180?(g=0,p=c,u=m):n<240?(g=0,p=m,u=c):n<300?(g=m,p=0,u=c):(g=c,p=0,u=m);const q=g+E,O=p+E,U=u+E;return{r:q,g:O,b:U}}function Z(){const t=C.getImageData(0,0,_,_),e=t.data;for(let r=0;r<_;r++)for(let n=0;n<_;n++){const s=n-b,l=r-b,c=Math.sqrt(s*s+l*l);if(c<=b){const m=Math.atan2(l,s),{r:E,g,b:p}=X(m,c/b,V),u=(r*_+n)*4;e[u]=E*255,e[u+1]=g*255,e[u+2]=p*255,e[u+3]=255}}C.putImageData(t,0,0)}function F(t=!1){P.slider.disabled=!i.state,P.slider.value=i.brightness,P.label.textContent=(i.brightness*100).toFixed(2),T.slider.disabled=!i.state,T.slider.value=1-(i.color_temp-i.min_color_temp)/(i.max_color_temp-i.min_color_temp),T.label.textContent=(1e6/i.color_temp).toFixed(2)+"K",N.textContent=i.state?"Turn Off":"Turn On";const e=i.state;(S!==e||S&&V!==i.brightness)&&(S=e,V=i.brightness,C.clearRect(0,0,_,_),S?(x.style.pointerEvents="auto",Z()):(C.fillStyle="rgba(100, 100, 100, 0.5)",C.beginPath(),C.arc(b,b,b,0,2*Math.PI),C.fill())),t||i.debounce()}P.slider.addEventListener("input",()=>{i.brightness=P.slider.value,F()});T.slider.addEventListener("input",()=>{i.color_temp=i.min_color_temp+(1-T.slider.value)*(i.max_color_temp-i.min_color_temp),F()});N.addEventListener("click",()=>{i.state=!i.state,F()});x.addEventListener("pointerdown",t=>{const e=s=>{const l=x.getBoundingClientRect();let c=s.clientX-l.left-b,m=s.clientY-l.top-b;const E=Math.min(Math.sqrt(c*c+m*m),b),g=Math.atan2(m,c),{r:p,g:u,b:q}=X(g,E/b,1),O=[p,u,q],U=`RGB: (${O.map(Y=>Y.toFixed(2)).join(", ")})`;J.textContent=U,i.setColor(O[0],O[1],O[2]),F()},r=s=>{s.preventDefault(),e(s)},n=()=>{document.removeEventListener("pointermove",r),document.removeEventListener("pointerup",n)};document.addEventListener("pointermove",r),document.addEventListener("pointerup",n),e(t)});A.fetch().then(t=>{i=t,N.disabled=!1,F(!0)});
